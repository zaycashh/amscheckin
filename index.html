<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AMS Check-In System</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  margin: 0;
  padding: 0;
  background: #f5f5f5;
  color: #222;
}
header {
  background: #ffffff;
  border-bottom: 4px solid #4F8C47;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.header-left { display: flex; align-items: center; gap: 10px; }
.header-logo img { height: 52px; border-radius: 6px; }
.header-text-main { font-size: 1.15rem; font-weight: 700; color: #D9A441; }
.header-text-sub { font-size: 0.85rem; color: #4F8C47; }
.card {
  background: white; border-radius: 10px; padding: 16px; margin: 16px 0;
  border-top: 3px solid #D9A441; box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}
label { display:block; font-weight:500; margin-top:8px; }
input, select, button {
  width:100%; padding:10px; border-radius:8px;
  border:1px solid #ccc; margin-top:4px; font-size:1rem;
}
button { background:#4F8C47; color:white; font-weight:600; cursor:pointer; }
button.secondary { background:#1E3A59; }
.pill-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.pill {
  padding:4px 10px; border-radius:999px; border:1px solid #4F8C47;
  background:#eaf5ec; cursor:pointer; font-size:0.8rem;
}
table { width:100%; border-collapse:collapse; margin-top:12px; font-size:0.9rem; }
th, td { border:1px solid #ddd; padding:6px; white-space:nowrap; }
</style>
</head>

<body>

<header>
  <div class="header-left">
    <div class="header-logo"><img src="ams_logo_cropped.jpg"></div>
    <div>
      <div class="header-text-main">AMS Check-In</div>
      <div class="header-text-sub">airport medical solutions</div>
    </div>
  </div>
  <div class="header-tagline">Your One Stop Compliance Shop</div>
</header>

<main>

<script>
/* STORAGE */
const STORAGE_KEY = "ams_records_v1";
const COMPANY_KEY = "ams_company_list_v1";
const ADMIN_PIN = "2468";

/* LOAD + SAVE */
function loadRecords(){ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
function saveRecords(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }
function addRecord(r){ const list = loadRecords(); list.push(r); saveRecords(list); }

/* COMPANIES */
function loadCompanies(){ return JSON.parse(localStorage.getItem(COMPANY_KEY) || "[]"); }
function saveCompanies(list){ localStorage.setItem(COMPANY_KEY, JSON.stringify(list)); }

function renderCompanySelect(){
  const sel = document.getElementById("companySelect");
  sel.innerHTML = `<option value="">-- Select Company --</option>`;
  loadCompanies().forEach(c=>{
    sel.innerHTML += `<option value="${c}">${c}</option>`;
  });
  sel.innerHTML += `<option value="__OTHER__">Other (type)</option>`;
}

/* OTHER WIRING */
function htmlEscape(s){ return s.replace(/[&<>]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[m])); }
function formatDateTime(iso){
  const d = new Date(iso);
  return {
    date: d.toLocaleDateString(),
    time: d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})
  };
}
/* SIGNATURE PAD */
function setupSignaturePad(){
  const pad = document.getElementById("signaturePad");
  const ctx = pad.getContext("2d");
  let drawing = false, signed = false;

  function resize(){
    pad.width = pad.clientWidth;
    pad.height = 140;
  }
  resize();
  window.addEventListener("resize", resize);

  pad.addEventListener("mousedown", e=>{ drawing=true; signed=true; ctx.moveTo(e.offsetX,e.offsetY); });
  pad.addEventListener("mousemove", e=>{ if(drawing){ ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke(); }});
  window.addEventListener("mouseup", ()=> drawing=false);

  return {
    has:()=>signed,
    get:()=> pad.toDataURL("image/png"),
    clear:()=>{ ctx.clearRect(0,0,pad.width,pad.height); signed=false; }
  };
}

/* SUBMIT */
function setupSubmit(sig){
  document.getElementById("submitBtn").onclick = ()=>{

    let first = document.getElementById("firstName").value.trim();
    let last = document.getElementById("lastName").value.trim();
    let compSel = document.getElementById("companySelect").value;
    let compOther = document.getElementById("otherCompany").value.trim();
    let reason = document.getElementById("reasonSelect").value;
    let reasonOther = document.getElementById("otherReason").value.trim();

    if(compSel==="__OTHER__") compSel = compOther;
    if(reason==="Other") reason = reasonOther;

    if(!first || !last || !compSel || !reason){ alert("Complete all fields."); return; }
    if(!sig.has()){ alert("Signature required."); return; }

    const svc = [];
    if(document.getElementById("svc_drug").checked) svc.push("Drug");
    if(document.getElementById("svc_dna").checked) svc.push("DNA");
    if(document.getElementById("svc_vision").checked) svc.push("Vision");
    if(document.getElementById("svc_alcohol").checked) svc.push("Alcohol");
    if(document.getElementById("svc_dot").checked) svc.push("DOT");
    if(document.getElementById("svc_other").checked){
        svc.push("Other: "+document.getElementById("svc_other_text").value.trim());
    }

    addRecord({
      id: Date.now(),
      first, last,
      company: compSel,
      reason,
      services: svc.join(" | "),
      timestamp: new Date().toISOString(),
      signature: sig.get()
    });

    alert("Saved!");
    sig.clear();
  };
}

/* SEARCH FOR INDIVIDUAL */
function searchIndividuals(){
  const name = document.getElementById("searchName").value.toLowerCase();
  const comp = document.getElementById("searchCompany").value.toLowerCase();
  const date = document.getElementById("searchDate").value;

  const list = loadRecords();
  const tb = document.getElementById("searchTableBody");
  tb.innerHTML = "";

  list.filter(r=>{
    const d = new Date(r.timestamp);
    const ds = d.toISOString().split("T")[0];
    return (!name || r.first.toLowerCase().includes(name) || r.last.toLowerCase().includes(name))
      && (!comp || r.company.toLowerCase().includes(comp))
      && (!date || ds===date);
  })
  .sort((a,b)=> new Date(b.timestamp)-new Date(a.timestamp))
  .forEach(r=>{
    const dt = formatDateTime(r.timestamp);
    tb.innerHTML += `
      <tr>
        <td>${dt.date}</td><td>${dt.time}</td>
        <td>${r.first}</td><td>${r.last}</td>
        <td>${r.company}</td><td>${r.reason}</td>
        <td>${htmlEscape(r.services)}</td>
      </tr>`;
  });
}

/* GENERAL REPORT */
function applyPreset(p){
  const s=document.getElementById("genStart"), e=document.getElementById("genEnd");
  let S=new Date(),E=new Date();
  switch(p){
    case"today":break;
    case"yesterday":S.setDate(S.getDate()-1);E=new Date(S);break;
    case"thisWeek":S.setDate(S.getDate()-S.getDay());break;
    case"lastWeek":S.setDate(S.getDate()-S.getDay()-7);E=new Date(S);E.setDate(S.getDate()+6);break;
    case"thisMonth":S=new Date(S.getFullYear(),S.getMonth(),1);break;
    case"lastMonth":S=new Date(S.getFullYear(),S.getMonth()-1,1);E=new Date(S.getFullYear(),S.getMonth()+1,0);break;
    case"thisYear":S=new Date(S.getFullYear(),0,1);break;
    case"lastYear":S=new Date(S.getFullYear()-1,0,1);E=new Date(S.getFullYear(),11,31);break;
  }
  s.value=S.toISOString().split("T")[0];
  e.value=E.toISOString().split("T")[0];
}

function runGeneralReport(){
  const s=document.getElementById("genStart").value;
  const e=document.getElementById("genEnd").value;
  const comp=document.getElementById("genCompany").value.toLowerCase();
  const tb=document.getElementById("generalBody");
  tb.innerHTML="";

  if(!s||!e){ tb.innerHTML=`<tr><td colspan="7">Select date range</td></tr>`; return;}

  let S=new Date(s),E=new Date(e+"T23:59:59");
  loadRecords().filter(r=>{
    const d=new Date(r.timestamp);
    return d>=S && d<=E && (!comp || r.company.toLowerCase()===comp);
  })
  .sort((a,b)=> new Date(a.timestamp)-new Date(b.timestamp))
  .forEach(r=>{
    const dt=formatDateTime(r.timestamp);
    tb.innerHTML+=`
      <tr>
        <td>${dt.date}</td><td>${dt.time}</td>
        <td>${r.first}</td><td>${r.last}</td>
        <td>${r.company}</td><td>${r.reason}</td>
        <td>${htmlEscape(r.services)}</td>
      </tr>`;
  });
}

/* INIT */
document.addEventListener("DOMContentLoaded", ()=>{
  renderCompanySelect();
  const sig=setupSignaturePad();
  setupSubmit(sig);
});
</script>

<!-- ============================ CHECK-IN FORM ============================ -->
<section class="card">
  <h2>Check-In</h2>

  <label>First Name</label>
  <input id="firstName">

  <label>Last Name</label>
  <input id="lastName">

  <label>Company</label>
  <select id="companySelect"></select>
  <input id="otherCompany" placeholder="Type company here">

  <label>Reason for Testing</label>
  <select id="reasonSelect">
    <option value="">Select reason</option>
    <option>Random</option>
    <option>Pre-Employment</option>
    <option>Post-Accident</option>
    <option>Reasonable Suspicion</option>
    <option>Follow-Up</option>
    <option>Return to Duty</option>
    <option>Other</option>
  </select>
  <input id="otherReason" placeholder="Enter other reason">

  <label>Services</label>
  <input type="checkbox" id="svc_drug"> Drug Test<br>
  <input type="checkbox" id="svc_dna"> DNA / Paternity Test<br>
  <input type="checkbox" id="svc_vision"> Vision Test<br>
  <input type="checkbox" id="svc_alcohol"> Alcohol Test<br>
  <input type="checkbox" id="svc_dot"> DOT Test<br>
  <input type="checkbox" id="svc_other"> Other
  <input id="svc_other_text">

  <label>Signature</label>
  <canvas id="signaturePad" style="border:1px solid #ccc; width:100%; height:140px;"></canvas>

  <button id="submitBtn">Submit</button>
</section>

<!-- ============================ SEARCH FOR INDIVIDUAL ============================ -->
<section class="card">
  <h2>Search for Individual</h2>

  <label>Name</label>
  <input id="searchName">

  <label>Company</label>
  <input id="searchCompany">

  <label>Date</label>
  <input id="searchDate" type="date">

  <button onclick="searchIndividuals()">Search</button>

  <table>
    <thead>
      <tr><th>Date</th><th>Time</th><th>First</th><th>Last</th><th>Company</th><th>Reason</th><th>Services</th></tr>
    </thead>
    <tbody id="searchTableBody"></tbody>
  </table>
</section>

<!-- ============================ GENERAL REPORT ============================ -->
<section class="card">
  <h2>General Report</h2>

  <div class="pill-row">
    <span class="pill" onclick="applyPreset('today')">Today</span>
    <span class="pill" onclick="applyPreset('yesterday')">Yesterday</span>
    <span class="pill" onclick="applyPreset('thisWeek')">This Week</span>
    <span class="pill" onclick="applyPreset('lastWeek')">Last Week</span>
    <span class="pill" onclick="applyPreset('thisMonth')">This Month</span>
    <span class="pill" onclick="applyPreset('lastMonth')">Last Month</span>
    <span class="pill" onclick="applyPreset('thisYear')">This Year</span>
    <span class="pill" onclick="applyPreset('lastYear')">Last Year</span>
  </div>

  <label>Start Date</label>
  <input type="date" id="genStart">

  <label>End Date</label>
  <input type="date" id="genEnd">

  <label>Company (optional)</label>
  <select id="genCompany">
    <option value="">All</option>
  </select>

  <button onclick="runGeneralReport()">Run Report</button>

  <table>
    <thead>
      <tr><th>Date</th><th>Time</th><th>First</th><th>Last</th><th>Company</th><th>Reason</th><th>Services</th></tr>
    </thead>
    <tbody id="generalBody"></tbody>
  </table>
</section>

</main>
</body>
</html>
