<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #222;
    }
    header {
      background: #ffffff;
      border-bottom: 4px solid #4F8C47;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-logo {
      height: 52px;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .header-logo img {
      height: 100%;
      width: auto;
      display: block;
    }
    .header-text-main {
      font-size: 1.1rem;
      font-weight: 700;
      color: #D9A441;
      line-height: 1.2;
    }
    .header-text-sub {
      font-size: 0.85rem;
      color: #4F8C47;
    }
    .header-tagline {
      font-size: 0.75rem;
      color: #1E3A59;
      font-style: italic;
      text-align: right;
      max-width: 180px;
    }
    main {
      padding: 12px;
      max-width: 960px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      padding: 14px;
      margin-bottom: 14px;
      border-top: 3px solid #D9A441;
    }
    h2 {
      font-size: 1.05rem;
      margin-top: 0;
      color: #1E3A59;
    }
    label {
      display: block;
      margin-top: 8px;
      font-size: 0.9rem;
      font-weight: 500;
    }
    input, button, select {
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      background: #4F8C47;
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
    }
    button.secondary {
      background: #1E3A59;
    }
    button:active {
      opacity: 0.85;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .col-4 {
      flex: 1 1 30%;
    }
    .col-6 {
      flex: 1 1 48%;
    }
    .col-12 {
      flex: 1 1 100%;
    }
    @media (max-width: 600px) {
      .col-4, .col-6 {
        flex: 1 1 100%;
      }
      .header-tagline {
        display: none;
      }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: left;
      white-space: nowrap;
    }
    th {
      background: #f0f0f0;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e3f2fd;
      color: #1E3A59;
      margin-left: 4px;
    }
    .small-text {
      font-size: 0.8rem;
      color: #666;
    }
    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .actions-row button {
      flex: 1 1 48%;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #4F8C47;
      background: #eaf5ec;
      font-size: 0.8rem;
      cursor: pointer;
      color: #1E3A59;
    }
    .summary-box {
      margin-top: 8px;
      padding: 8px;
      border-radius: 8px;
      background: #f7f9fc;
      border: 1px solid #dde4f2;
      font-size: 0.9rem;
    }
    .tag-list {
      font-size: 0.8rem;
      margin-top: 6px;
      color: #555;
    }
    .admin-toggle-row {
      text-align: right;
      margin-bottom: 6px;
    }
    .admin-toggle-btn {
      width: auto;
      padding: 6px 10px;
      font-size: 0.75rem;
      background: #1E3A59;
    }
    #signatureWrapper {
      position: relative;
      margin-top: 6px;
    }
    #signaturePad {
  width: 100%;
  height: 150px;              /* Ensure fixed drawing height */
  border: 1px solid #ccc;
  background: #ffffff;
  touch-action: none;         /* MUST HAVE for mobile/tablet drawing */
  display: block;
}
    #sigPlaceholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #888;
      font-size: 16px;
      pointer-events: none;
    }
    .sig-btn {
      width: auto;
      padding: 4px 8px;
      font-size: 0.75rem;
      background: #4F8C47;
      color: #fff;
      border-radius: 999px;
      border: none;
      cursor: pointer;
    }
  </style>

  <script>
    // Soft clinic-style ding on submit
    function playSubmitSound() {
      var audio = new Audio("data:audio/wav;base64,UklGRoQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQwAAACAgICAgICAgICAgICAhISEhISEhISEhICAhISEhISEhISEhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg");
      audio.volume = 0.35;
      audio.play().catch(e=>console.log(e));
    }
    
    function resetForm() {
    // Clear all text inputs
    document.querySelectorAll('input[type="text"]').forEach(i => i.value = "");

    // Reset dropdowns
    document.querySelectorAll("select").forEach(s => s.selectedIndex = 0);

    // Clear ALL checkboxes (service checkboxes + "other")
    document.querySelectorAll('.service-options input[type="checkbox"]').forEach(cb => cb.checked = false);

    // Hide "Other Company" field
    const otherCompanyWrapper = document.getElementById("otherCompanyWrapper");
    const otherCompanyInput = document.getElementById("otherCompany");
    if (otherCompanyWrapper) otherCompanyWrapper.style.display = "none";
    if (otherCompanyInput) otherCompanyInput.value = "";

    // Hide "Other Reason" field
    const otherReasonWrapper = document.getElementById("otherReasonWrapper");
    const otherReasonInput = document.getElementById("otherReasonInput");
    if (otherReasonWrapper) otherReasonWrapper.style.display = "none";
    if (otherReasonInput) otherReasonInput.value = "";

    // Clear signature pad
    const clearBtn = document.getElementById("clearSigBtn");
    if (clearBtn) clearBtn.click();

    // Clear status message
    const msg = document.getElementById("submitMessage");
    if (msg) msg.textContent = "";

    alert("Form has been reset.");
}

  </script>
</head>
<body>
  <header>
    <div class="header-left">
      <div class="header-logo">
        <img src="ams_logo_cropped.jpg" alt="AMS logo" />
      </div>
      <div>
        <div class="header-text-main">AMS Check-In</div>
        <div class="header-text-sub">airport medical solutions</div>
      </div>
    </div>
    <div class="header-tagline">Your One Stop Compliance Shop</div>
  </header>
  <main>
    <!-- Public: New Check-In (donors/employees see this only) -->
    <section class="card">
      <h2>Check-In</h2>
      <div class="row">
        <div class="col-6">
          <label for="firstName">First Name</label>
          <input id="firstName" type="text" autocomplete="off" required />
        </div>
        <div class="col-6">
          <label for="lastName">Last Name</label>
          <input id="lastName" type="text" autocomplete="off" required />
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <label for="companySelect">Company (Employer)</label>
          <select id="companySelect" onchange="toggleOtherCompany()">
          </select>
          <div class="col-6" id="otherCompanyWrapper" style="display:none; margin-top:10px;">
    <label for="otherCompany">Other Company (type manually)</label>
    <input id="otherCompany" type="text" placeholder="Enter company name..." autocomplete="off" />
</div>
        
          <!-- END of Company Row -->

<!-- PASTE SERVICE CHECKBOXES HERE -->
<div class="service-options" style="margin-top:15px;">
    <label style="font-weight:bold;">Service Type</label>

    <!-- Row 1 -->
    <div style="display:flex; gap:25px; margin-top:10px; align-items:center;">
        <label><input type="checkbox" name="service_drug"> Drug Test</label>
        <label><input type="checkbox" name="service_dna"> DNA Paternity Test</label>
        <label><input type="checkbox" name="service_vision"> Vision Test</label>
    </div>

    <!-- Row 2 -->
    <div style="display:flex; gap:25px; margin-top:10px; align-items:center;">
        <label><input type="checkbox" name="service_alcohol"> Alcohol Test</label>
        <label><input type="checkbox" name="service_dot"> DOT Physical</label>

        <label>
            <input type="checkbox" id="service_other" onclick="toggleOtherInput()"> Other
        </label>

        <input
            type="text"
            id="other_reason"
            placeholder="Enter reason..."
            style="display:none; padding:4px; border:1px solid #ccc; border-radius:5px;"
        />
    </div>
</div> 

<!-- END OF SERVICE CHECKBOXES -->

      <label for="reasonSelect">Reason for Testing</label>
      <select id="reasonSelect" onchange="toggleOtherReason()">
        <option value="">-- Select reason --</option>
        <option value="Pre-employment">Pre-employment</option>
        <option value="Random">Random</option>
        <option value="Reasonable suspicion">Reasonable suspicion</option>
        <option value="Post-accident">Post-accident</option>
        <option value="Return to duty">Return to duty</option>
        <option value="Follow up">Follow up</option>
        <option value="Other (personal)">Other (personal)</option>
      </select>
      <div id="otherReasonWrapper" style="display:none; margin-top:10px;">
          <label for="otherReasonInput">Other Reason (type manually)</label>
          <input id="otherReasonInput" type="text" placeholder="Enter other reason..." autocomplete="off" />
      </div>

      <label for="signaturePad">Donor Signature</label>
      <div id="signatureWrapper">
        <canvas id="signaturePad"></canvas>
        <div id="sigPlaceholder">Sign here</div>
      </div>
      <button type="button" id="clearSigBtn" class="secondary" style="width:auto; padding:6px 10px; font-size:0.8rem; margin-top:6px;">Clear Signature</button>

      <p class="small-text">
        Donor must sign above. Date &amp; time in are recorded automatically when you tap "Submit Check-In".
      </p>

      <div style="display:flex; gap:10px; margin-top:10px;">

    <!-- Submit Button (unchanged) -->
    <button id="submitBtn" style="flex:1;">
        Submit Check-In
    </button>

    <!-- Reset Button (RED) -->
    <button type="button"
            onclick="resetForm()"
            style="
                flex:1;
                background:#d9534f;
                color:white;
                padding:12px;
                border:none;
                border-radius:6px;
                font-size:1rem;
                cursor:pointer;">
        Reset Form
    </button>

</div>

      <p id="submitMessage" class="small-text"></p>
    </section>

    <!-- Small admin login control -->
    <div class="admin-toggle-row">
      <button id="toggleAdminBtn" class="admin-toggle-btn">Admin Login</button>
      <span class="small-text" id="adminStatusText"></span>
    </div>

    <!-- ADMIN-ONLY AREA (hidden until PIN is entered) -->
    <div id="adminArea" style="display:none;">
      <!-- Search Log -->
      <section class="card">
        <h2>Search For Individual</h2>
        <div class="row">
          <div class="col-4">
            <label for="searchName">Donor Name</label>
            <input id="searchName" type="text" placeholder="first or last name" />
          </div>
          <div class="col-4">
            <label for="searchCompany">Company Name</label>
            <input id="searchCompany" type="text" placeholder="e.g. ABC Logistics" />
          </div>
          <div class="col-4">
            <label for="searchDate">Date</label>
            <input id="searchDate" type="date" />
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <label for="searchReason">Reason for Test</label>
            <select id="searchReason">
              <option value="">Any reason</option>
              <option value="Pre-employment">Pre-employment</option>
              <option value="Random">Random</option>
              <option value="Reasonable suspicion">Reasonable suspicion</option>
              <option value="Post-accident">Post-accident</option>
              <option value="Return to duty">Return to duty</option>
              <option value="Follow up">Follow up</option>
              <option value="Other (personal)">Other (personal)</option>
            </select>
          </div>
        </div>
        <div class="actions-row">
          <button id="searchBtn">Search</button>
          <button id="clearFilterBtn" class="secondary">Clear Filters</button>
        </div>
        <p class="small-text">For AMS internal use only (billing, audits, etc.).</p>
        <div style="overflow-x:auto;">
          <table id="resultsTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time In</th>
                <th>First</th>
                <th>Last</th>
                <th>Company</th>
                <th>Reason</th>
                <th>Services</th>
                <th>Signature</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
        <div class="actions-row">
          <button id="exportExcelBtn">Export Results to Excel</button>
          <button id="exportPdfBtn">Export Results to PDF</button>
        </div>
      </section>

      <!-- Reports -->
      <section class="card">
        <h2>Detail Company Report</h2>
        <!-- DATE PRESETS -->
<div class="pill-row" style="margin-top:10px;">
    <span class="pill" data-companyrange="today">Today</span>
    <span class="pill" data-companyrange="yesterday">Yesterday</span>

    <span class="pill" data-companyrange="thisWeek">This Week</span>
    <span class="pill" data-companyrange="lastWeek">Last Week</span>

    <span class="pill" data-companyrange="thisMonth">This Month</span>
    <span class="pill" data-companyrange="lastMonth">Last Month</span>

    <span class="pill" data-companyrange="thisYear">This Year</span>
    <span class="pill" data-companyrange="lastYear">Last Year</span>
  <span class="pill" data-companyrange="custom">Custom Range</span>
</div>

        <div class="row">
          <div class="col-6">
            <label for="reportStart">Start Date</label>
            <input id="reportStart" type="date" />
          </div>
          <div class="col-6">
            <label for="reportEnd">End Date</label>
            <input id="reportEnd" type="date" />
          </div>
        </div>
        
        <div class="row">
          <div class="col-6">
            <label for="reportCompany">Company (optional)</label>
            <input id="reportCompany" type="text" placeholder="filter to one company" />
          </div>
          <div class="col-6">
            <label for="reportName">Donor Name (optional)</label>
            <input id="reportName" type="text" placeholder="first or last name" />
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            <label for="reportReason">Reason (optional)</label>
            <select id="reportReason">
              <option value="">Any reason</option>
              <option value="Pre-employment">Pre-employment</option>
              <option value="Random">Random</option>
              <option value="Reasonable suspicion">Reasonable suspicion</option>
              <option value="Post-accident">Post-accident</option>
              <option value="Return to duty">Return to duty</option>
              <option value="Follow up">Follow up</option>
              <option value="Other (personal)">Other (personal)</option>
            </select>
          </div>
        </div>
        <div class="actions-row">
          <button id="runReportBtn">Run Report</button>
          <button id="clearReportBtn" class="secondary">Clear Report Filters</button>
        </div>

        <div id="reportSummary" class="summary-box" style="display:none;"></div>

        <div style="overflow-x:auto; margin-top:8px;">
          <table id="reportTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time In</th>
                <th>First</th>
                <th>Last</th>
                <th>Company</th>
                <th>Reason</th>
                <th>Signature</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>

        <div class="actions-row">
          <button id="exportReportXlsBtn" class="secondary">Export REPORT as Excel (.xls)</button>
          <button id="printReportBtn" class="secondary">Print REPORT (PDF)</button>
        </div>
      </section>
    
      <!-- Recent Check-Ins -->
      <section class="card">
        <h2>Recent Check-Ins <span class="badge" id="countBadge">0</span></h2>
        <div style="overflow-x:auto;">
          <table id="recentTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time In</th>
                <th>First</th>
                <th>Last</th>
                <th>Company</th>
                <th>Reason</th>
                <th>Signature</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Admin: Manage Companies -->
      <section class="card">
        <h2>Manage Company List (Admin)</h2>
        <div class="row">
          <div class="col-6">
            <label for="newCompany">Add Company Name</label>
            <input id="newCompany" type="text" placeholder="e.g. ABC Logistics" />
          </div>
          <div class="col-6" style="display:flex; align-items:flex-end;">
            <button id="addCompanyBtn">Add to List</button>
          </div>
        </div>
        <p class="small-text">
    These companies appear in the dropdown for donors. You can add, edit, delete, or search companies below.
</p>

<!-- ðŸ” Search bar -->
<input 
    type="text" 
    id="companySearch" 
    placeholder="Search company..." 
    style="width: 100%; padding: 6px; margin-bottom: 10px;"
/>

<!-- Company List Display -->
<div id="companyListDisplay" class="tag-list"></div>

<!-- Unified Edit/Delete Panel -->
<div id="editDeletePanel" style="display:none; margin-top:15px; padding:12px; border:1px solid #ccc; border-radius:8px; background:#fafafa;">
    <h4 style="margin:0 0 10px 0;">Selected Company: <span id="selectedCompany" style="color:#4F8C47; font-weight:bold;"></span></h4>

    <button onclick="editCompany()" style="background:#1E3A59; margin-bottom:8px; width:100%;">Edit Company</button>
    <button onclick="deleteCompany()" style="background:#d9534f; width:100%;">Delete Company</button>
</div>

        
  </main>

<script>
// ===============================
// COMPANY STORAGE
// ===============================

const COMPANY_LIST_KEY = "companyListStorage";

function loadCompanyList() {
    try {
        const raw = localStorage.getItem(COMPANY_LIST_KEY);
        return raw ? JSON.parse(raw) : [];
    } catch (e) {
        return [];
    }
}

function saveCompanyList(list) {
    localStorage.setItem(COMPANY_LIST_KEY, JSON.stringify(list));
}

// ===============================
// RENDER COMPANY DROPDOWN
// ===============================

function renderCompanySelect() {
    const select = document.getElementById("companySelect");
    if (!select) return;

    const companies = loadCompanyList();
    select.innerHTML = "";

    const defaultOpt = document.createElement("option");
    defaultOpt.value = "";
    defaultOpt.textContent = "-- Select Company --";
    select.appendChild(defaultOpt);

    companies.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
    });

    const otherOpt = document.createElement("option");
    otherOpt.value = "OTHER_COMPANY";
    otherOpt.textContent = "Other (type manually)";
    select.appendChild(otherOpt);
}

// ===============================
// RENDER ADMIN LIST (EDIT + DELETE)
// ===============================

function renderCompanyListDisplay() {
    const container = document.getElementById("companyListDisplay");
    if (!container) return;

    const search = document.getElementById("companySearch").value.toLowerCase();
    const list = loadCompanyList();

    container.innerHTML = "";

    list
  .filter(name => name.toLowerCase().includes(search))
  .forEach((name, idx) => {

      const row = document.createElement("div");
      row.className = "tag";

      const label = document.createElement("span");
      label.textContent = name;

      row.appendChild(label);

      row.addEventListener("click", () => {
          document.getElementById("selectedCompany").textContent = name;
          document.getElementById("editDeletePanel").style.display = "block";
      });

      container.appendChild(row);
  });

}   // <-- THIS LINE WAS MISSING
// ===============================
// UNIFIED EDIT / DELETE FUNCTIONS

// ===============================
// UNIFIED EDIT / DELETE FUNCTIONS
// ===============================

function editCompany() {
    const selected = document.getElementById("selectedCompany").textContent;
    if (!selected) return alert("No company selected.");

    const newName = prompt("Enter new company name:", selected);

    if (newName && newName.trim()) {
        let companies = loadCompanyList();
        const index = companies.indexOf(selected);
        companies[index] = newName.trim();
        saveCompanyList(companies);
        renderCompanySelect();
        renderCompanyListDisplay();
    }
}

function deleteCompany() {
    const selected = document.getElementById("selectedCompany").textContent;
    if (!selected) return alert("No company selected.");

    if (confirm("Delete " + selected + "?")) {
        let companies = loadCompanyList().filter(c => c !== selected);
        saveCompanyList(companies);
        renderCompanySelect();
        renderCompanyListDisplay();
        document.getElementById("editDeletePanel").style.display = "none";
    }
}

// ===============================
// DATE PRESETS FOR COMPANY REPORT
// ===============================

function applyCompanyDatePreset(range) {
    const from = document.getElementById("companyFrom");
    const to = document.getElementById("companyTo");

    const today = new Date();
    let start, end;

    switch (range) {
        case "today":
            start = end = today;
            break;

        case "yesterday":
            start = end = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 1);
            break;

        case "thisWeek":
            start = new Date(today.setDate(today.getDate() - today.getDay()));
            end = new Date();
            break;

        case "lastWeek":
            const curr = today.getDay();
            start = new Date(today.setDate(today.getDate() - curr - 7));
            end = new Date(today.setDate(start.getDate() + 6));
            break;

        case "thisMonth":
            start = new Date(today.getFullYear(), today.getMonth(), 1);
            end = new Date();
            break;

        case "lastMonth":
            start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            end = new Date(today.getFullYear(), today.getMonth(), 0);
            break;

        case "thisYear":
            start = new Date(today.getFullYear(), 0, 1);
            end = new Date();
            break;

        case "lastYear":
            start = new Date(today.getFullYear() - 1, 0, 1);
            end = new Date(today.getFullYear() - 1, 11, 31);
            break;
    }

    from.value = start.toISOString().split("T")[0];
    to.value = end.toISOString().split("T")[0];
}

// ===============================
// GENERATE COMPANY REPORT
// ===============================

function generateCompanyReport() {
    const company = document.getElementById("companySelect").value;
    const start = document.getElementById("companyFrom").value;
    const end = document.getElementById("companyTo").value;

    if (!company) return alert("Select a company first.");
    if (!start || !end) return alert("Select date range.");

    alert(`Report generated for:\n\nCompany: ${company}\nFrom: ${start}\nTo: ${end}`);

    // Hook your real report logic here
}// Show manual company field when "Other" is selected
function toggleOtherCompany() {
    const select = document.getElementById("companySelect");
    const wrapper = document.getElementById("otherCompanyWrapper");

    if (select.value === "OTHER_COMPANY") {
        wrapper.style.display = "block";
    } else {
        wrapper.style.display = "none";
    }
}

// Show manual Reason field
function toggleOtherReason() {
    const select = document.getElementById("reasonSelect");
    const wrapper = document.getElementById("otherReasonWrapper");

    if (select.value === "Other (personal)") {
        wrapper.style.display = "block";
    } else {
        wrapper.style.display = "none";
    }
}

// Show text field when Service = Other
function toggleOtherInput() {
    const cb = document.getElementById("service_other");
    const input = document.getElementById("other_reason");

    if (cb.checked) {
        input.style.display = "inline-block";
    } else {
        input.style.display = "none";
        input.value = "";
    }
}

// ===============================
// EVENT LISTENERS ON PAGE LOAD
// ===============================

document.addEventListener("DOMContentLoaded", () => {

    // INITIAL RENDER
    if (!localStorage.getItem(COMPANY_LIST_KEY)) {
        saveCompanyList([]);
    }

    renderCompanySelect();
    renderCompanyListDisplay();

    // ADD COMPANY
    document.getElementById("addCompanyBtn").addEventListener("click", () => {
        const newName = document.getElementById("newCompany").value.trim();
        if (!newName) return alert("Enter company name.");

        const list = loadCompanyList();
        list.push(newName);
        saveCompanyList(list);

        document.getElementById("newCompany").value = "";
        renderCompanySelect();
        renderCompanyListDisplay();
    });

    // SEARCH FILTER
    document.getElementById("companySearch").addEventListener("input", () => {
        renderCompanyListDisplay();
    });

    // DATE PRESET BUTTONS
    document.querySelectorAll("[data-companyrange]").forEach(btn => {
        btn.addEventListener("click", () => {
            applyCompanyDatePreset(btn.dataset.companyrange);
        });
    });

    // REPORT BUTTON
    const runBtn = document.getElementById("runCompanyReportBtn");
    if (runBtn) runBtn.onclick = generateCompanyReport;
});
// ===============================
// ADMIN LOGIN SYSTEM
// ===============================

let ADMIN_UNLOCKED = false;
const ADMIN_PIN = "4455";  // <-- Change this PIN if you want

function toggleAdmin() {
    if (!ADMIN_UNLOCKED) {
        const pin = prompt("Enter Admin PIN:");
        if (pin === ADMIN_PIN) {
            ADMIN_UNLOCKED = true;
            document.getElementById("adminArea").style.display = "block";
            document.getElementById("adminStatusText").textContent = "Admin Mode Active";
            alert("Admin Access Granted");
        } else {
            alert("Incorrect PIN");
        }
    } else {
        // If already unlocked â†’ hide admin
        ADMIN_UNLOCKED = false;
        document.getElementById("adminArea").style.display = "none";
        document.getElementById("adminStatusText").textContent = "";
        alert("Admin Logged Out");
    }
}

// Bind the button
document.getElementById("toggleAdminBtn").addEventListener("click", toggleAdmin);
  
<script>
// ===============================
// SIGNATURE PAD
// ===============================
let sigCanvas = document.getElementById("signaturePad");
let sigCtx = sigCanvas.getContext("2d");
// Fix for drawing visibility
sigCtx.lineWidth = 2;
sigCtx.lineJoin = "round";
sigCtx.lineCap = "round";
sigCtx.strokeStyle = "#000";

let drawing = false;
let lastX = 0;
let lastY = 0;

// Resize canvas to fit container
function resizeSignaturePad() {
    sigCanvas.width = sigCanvas.offsetWidth;
    sigCanvas.height = sigCanvas.offsetHeight;
}
resizeSignaturePad();
window.addEventListener("resize", resizeSignaturePad);

// Start drawing
function startDraw(e) {
    drawing = true;
    const rect = sigCanvas.getBoundingClientRect();
    lastX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    lastY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

    document.getElementById("sigPlaceholder").style.display = "none";
}

// Draw lines
function draw(e) {
    if (!drawing) return;

    const rect = sigCanvas.getBoundingClientRect();
    let x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    let y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

    sigCtx.lineWidth = 2;
    sigCtx.lineCap = "round";
    sigCtx.strokeStyle = "#000";

    sigCtx.beginPath();
    sigCtx.moveTo(lastX, lastY);
    sigCtx.lineTo(x, y);
    sigCtx.stroke();

    lastX = x;
    lastY = y;
}

// Stop drawing
function endDraw() {
    drawing = false;
}

// Clear signature
document.getElementById("clearSigBtn").addEventListener("click", () => {
    sigCtx.clearRect(0, 0, sigCanvas.width, sigCanvas.height);
    document.getElementById("sigPlaceholder").style.display = "block";
});

// Mouse events
sigCanvas.addEventListener("mousedown", startDraw);
sigCanvas.addEventListener("mousemove", draw);
sigCanvas.addEventListener("mouseup", endDraw);
sigCanvas.addEventListener("mouseleave", endDraw);

// Touch events
sigCanvas.addEventListener("touchstart", startDraw);
sigCanvas.addEventListener("touchmove", draw);
sigCanvas.addEventListener("touchend", endDraw);
sigCanvas.addEventListener("touchcancel", endDraw);
</script>
 

   
</body>
</html>
